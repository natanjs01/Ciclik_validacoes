<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DiagnÃ³stico de Loop - Ciclik</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #e74c3c;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .alert {
      background: #ffe6e6;
      border-left: 4px solid #e74c3c;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      color: #c0392b;
    }

    .instructions {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .instructions ol {
      margin-left: 20px;
      margin-top: 10px;
    }

    .instructions li {
      margin: 10px 0;
      line-height: 1.6;
    }

    .code-box {
      background: #2d3748;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      margin: 15px 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .button {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin: 20px 0;
      transition: transform 0.2s;
    }

    .button:hover {
      transform: translateY(-2px);
    }

    .button-secondary {
      background: #95a5a6;
    }

    .results {
      display: none;
      background: #2d3748;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      min-height: 200px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.8;
    }

    .error {
      color: #e74c3c;
      font-weight: bold;
    }

    .success {
      color: #27ae60;
      font-weight: bold;
    }

    .warning {
      color: #f39c12;
      font-weight: bold;
    }

    .metric {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      border-bottom: 1px solid #4a5568;
    }

    .metric:last-child {
      border-bottom: none;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #e74c3c;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš¨ DiagnÃ³stico de Loop Infinito</h1>
    
    <div class="alert">
      <strong>âš ï¸ ATENÃ‡ÃƒO:</strong> Esta ferramenta irÃ¡ monitorar a pÃ¡gina por 5 segundos para detectar a causa do loop infinito.
    </div>

    <div class="instructions">
      <strong>ğŸ“‹ InstruÃ§Ãµes:</strong>
      <ol>
        <li>Abra a pÃ¡gina do Ciclik com problema em outra aba</li>
        <li>Pressione <strong>F12</strong> para abrir DevTools</li>
        <li>Clique na aba <strong>Console</strong></li>
        <li>Clique no botÃ£o abaixo para copiar o cÃ³digo</li>
        <li>Cole o cÃ³digo no Console e pressione Enter</li>
        <li>Aguarde 5 segundos</li>
        <li>Copie o resultado e me envie</li>
      </ol>
    </div>

    <button class="button" onclick="copyCode()">
      ğŸ“‹ Copiar CÃ³digo de DiagnÃ³stico
    </button>

    <div class="code-box" id="diagnosticCode">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIAGNÃ“STICO: Detectar Causa do Loop
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function() {
  console.clear();
  console.log('%cğŸ” DIAGNÃ“STICO INICIADO', 'font-size: 16px; font-weight: bold; color: #e74c3c;');
  console.log('Monitorando por 5 segundos...\n');

  let renderCount = 0;
  let effectCount = 0;
  let navigateCount = 0;
  let requestCount = 0;
  let stateUpdateCount = 0;
  const requestUrls = [];
  const consoleMessages = [];

  // Interceptar console
  const originalLog = console.log;
  const originalWarn = console.warn;
  const originalError = console.error;

  console.log = function(...args) {
    const message = String(args[0] || '');
    consoleMessages.push(message);
    
    if (message.includes('render') || message.includes('Render')) renderCount++;
    if (message.includes('useEffect') || message.includes('effect')) effectCount++;
    if (message.includes('navigate') || message.includes('Navigate')) navigateCount++;
    if (message.includes('setState') || message.includes('set')) stateUpdateCount++;
    
    originalLog.apply(console, args);
  };

  // Interceptar fetch
  const originalFetch = window.fetch;
  window.fetch = function(...args) {
    requestCount++;
    const url = String(args[0]);
    requestUrls.push(url);
    return originalFetch.apply(this, args);
  };

  // Resultado apÃ³s 5 segundos
  setTimeout(() => {
    // Restaurar funÃ§Ãµes originais
    console.log = originalLog;
    console.warn = originalWarn;
    console.error = originalError;
    window.fetch = originalFetch;

    console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('%cğŸ“Š RESULTADO DO DIAGNÃ“STICO', 'font-size: 16px; font-weight: bold; color: #3498db;');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    console.log(`URL: ${window.location.href}`);
    console.log(`Navegador: ${navigator.userAgent.split(' ').slice(-2).join(' ')}`);
    console.log(`Timestamp: ${new Date().toLocaleString('pt-BR')}\n`);

    // MÃ©tricas
    const isLooping = renderCount > 100 || effectCount > 100 || requestCount > 50;
    
    console.log('ğŸ“ˆ MÃ‰TRICAS (5 segundos):');
    console.log(`   ğŸ”„ Re-renders: ${renderCount} ${renderCount > 100 ? 'ğŸš¨ LOOP!' : 'âœ…'}`);
    console.log(`   âš¡ useEffect: ${effectCount} ${effectCount > 100 ? 'ğŸš¨ LOOP!' : 'âœ…'}`);
    console.log(`   ğŸ§­ NavegaÃ§Ãµes: ${navigateCount} ${navigateCount > 10 ? 'ğŸš¨ LOOP!' : 'âœ…'}`);
    console.log(`   ğŸŒ HTTP Requests: ${requestCount} ${requestCount > 50 ? 'ğŸš¨ LOOP!' : 'âœ…'}`);
    console.log(`   ğŸ“ State Updates: ${stateUpdateCount}\n`);

    // DiagnÃ³stico
    if (isLooping) {
      console.log('%cğŸš¨ LOOP INFINITO DETECTADO!', 'font-size: 14px; font-weight: bold; color: #e74c3c; background: #ffe6e6; padding: 10px;');
      
      if (renderCount > 100) {
        console.log('%câš ï¸ CAUSA: Loop de Re-render', 'color: #e74c3c; font-weight: bold;');
        console.log('   Componente estÃ¡ re-renderizando infinitamente.');
        console.log('   Verifique: useState, useEffect, props mudando constantemente.\n');
      }
      
      if (effectCount > 100) {
        console.log('%câš ï¸ CAUSA: Loop de useEffect', 'color: #e74c3c; font-weight: bold;');
        console.log('   useEffect disparando infinitamente.');
        console.log('   Verifique: DependÃªncias do useEffect incluem funÃ§Ãµes ou objetos.\n');
      }
      
      if (requestCount > 50) {
        console.log('%câš ï¸ CAUSA: Loop de Requests', 'color: #e74c3c; font-weight: bold;');
        console.log('   Requests HTTP em loop.');
        console.log('   Endpoints mais chamados:');
        
        // Contar requests duplicados
        const urlCounts = {};
        requestUrls.forEach(url => {
          const shortUrl = url.split('?')[0].substring(0, 80);
          urlCounts[shortUrl] = (urlCounts[shortUrl] || 0) + 1;
        });
        
        Object.entries(urlCounts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5)
          .forEach(([url, count]) => {
            console.log(`      ${count}x - ${url}`);
          });
        console.log('');
      }
    } else {
      console.log('%câœ… NENHUM LOOP DETECTADO', 'font-size: 14px; font-weight: bold; color: #27ae60; background: #d5f4e6; padding: 10px;');
      console.log('   As mÃ©tricas estÃ£o normais.\n');
    }

    // Mensagens suspeitas
    const suspiciousMessages = consoleMessages.filter(msg => 
      msg.includes('erro') || 
      msg.includes('error') || 
      msg.includes('warning') ||
      msg.includes('loop') ||
      msg.includes('infinite')
    );

    if (suspiciousMessages.length > 0) {
      console.log('âš ï¸ MENSAGENS SUSPEITAS NO CONSOLE:');
      suspiciousMessages.slice(0, 10).forEach(msg => {
        console.log(`   - ${msg.substring(0, 100)}...`);
      });
      console.log('');
    }

    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('%cğŸ“‹ COPIE ESTE RESULTADO COMPLETO', 'font-size: 14px; font-weight: bold; color: #3498db;');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    // Gerar resumo copyable
    const summary = `
DIAGNÃ“STICO CICLIK - ${new Date().toLocaleString('pt-BR')}
URL: ${window.location.href}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
MÃ‰TRICAS (5 segundos):
  Re-renders: ${renderCount}
  useEffect: ${effectCount}
  NavegaÃ§Ãµes: ${navigateCount}
  HTTP Requests: ${requestCount}
  State Updates: ${stateUpdateCount}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STATUS: ${isLooping ? 'ğŸš¨ LOOP DETECTADO' : 'âœ… NORMAL'}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    `.trim();

    console.log(summary);

  }, 5000);

  console.log('â³ Monitorando... (aguarde 5 segundos)\n');
})();
</div>

    <button class="button button-secondary" onclick="openCiclikSite()">
      ğŸŒ Abrir Site do Ciclik
    </button>

    <div id="results" class="results"></div>

    <div class="instructions" style="margin-top: 30px;">
      <strong>ğŸ†˜ PRECISA DE AJUDA?</strong>
      <p style="margin-top: 10px; line-height: 1.6;">
        Se tiver dificuldades, tire um <strong>screenshot</strong> do Console apÃ³s executar o cÃ³digo e me envie!
      </p>
    </div>
  </div>

  <script>
    function copyCode() {
      const code = document.getElementById('diagnosticCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'âœ… CÃ³digo Copiado!';
        btn.style.background = '#27ae60';
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = '';
        }, 2000);
      });
    }

    function openCiclikSite() {
      window.open('https://natanjs01.github.io/Ciclik_validacoes/', '_blank');
    }
  </script>
</body>
</html>
